---
import { getCollection } from "astro:content";
import Layout from "@/layouts/Layout.astro";
import Header from "@/components/Header.astro";
import Footer from "@/components/Footer.astro";
import Card from "@/components/Card.astro";
import Hr from "@/components/Hr.astro";
import getSortedPosts from "@/utils/getSortedPosts";
import IconArrowRight from "@/assets/icons/IconArrowRight.svg";
import { SITE } from "@/config";
import LinkButton from "@/components/LinkButton.astro";
import Socials from "@/components/Socials.astro";
import IconRss from "@/assets/icons/IconRss.svg";

const posts = await getCollection("blog");

const sortedPosts = getSortedPosts(posts);
---

<Layout>
  <Header />
  <main id="main-content" data-layout="index">
    <section id="hero" class="pt-8 pb-6">
      <div class="flex items-center gap-3 mb-3">
        <h2 class="text-2xl font-bold text-foreground">About Me</h2>
        <a
          target="_blank"
          href={import.meta.env.BASE_URL + "rss.xml"}
          class="inline-flex items-center hover:scale-110 transition-transform"
          aria-label="Subscribe via RSS"
          title="Subscribe via RSS"
        >
          <IconRss
            width={20}
            height={20}
            class="scale-125 stroke-accent stroke-3"
          />
        </a>
      </div>
      <p class="mb-4">
        Hey, I'm Dannyâ€”DevOps engineer by day, fantasy football analyst by... also day, honestly. Based in Brno, I write about infrastructure, networking, weird bugs that shouldn't exist, and why my waiver wire strategy needs work. This blog is part technical documentation, part sports rant, and entirely influenced by my dog's disapproving stares. You've been warned.
      </p>
      <div class="mt-4 flex flex-col sm:flex-row sm:items-center">
        <div class="me-2 mb-1 whitespace-nowrap sm:mb-0 font-semibold">Social Links:</div>
        <Socials />
      </div>
    </section>

    <Hr />

    {
      sortedPosts.length > 0 && (
        <section id="recent-posts" class="pt-12 pb-6">
          <h2 class="text-2xl font-semibold tracking-wide">Recent Posts</h2>
          <ul>
            {sortedPosts.map(
              (data, index) =>
                index < SITE.postPerIndex && <Card variant="h3" {...data} />
            )}
          </ul>
        </section>
      )
    }

    <div class="my-8 text-center">
      <LinkButton href="/posts/">
        All Posts
        <IconArrowRight class="inline-block rtl:-rotate-180" />
      </LinkButton>
    </div>
  </main>
  <Footer />
</Layout>

<script>
  document.addEventListener("astro:page-load", () => {
    const indexLayout = (document.querySelector("#main-content") as HTMLElement)
      ?.dataset?.layout;
    if (indexLayout) {
      sessionStorage.setItem("backUrl", "/");
    }
  });
</script>